"""

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        DID Registry API                          â•‘
â•‘                  (Django â€“ logique mÃ©tier)                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â€¢ preview/compile (no I/O)                                 â”‚ â•‘
â•‘  â”‚ â€¢ create DID (DRAFT)                                       â”‚ â•‘
â•‘  â”‚ â€¢ update DID Document  (ownerâ€‘only)                        â”‚ â•‘
â•‘  â”‚ â€¢ deactivate (option)                                      â”‚ â•‘
â•‘  â”‚ â€¢ validation/gouvernance                                   â”‚ â•‘
â•‘  â”‚ â€¢ publish preprod/prod (BYOS):                             â”‚ â•‘
â•‘  â”‚     â€“ A: didState="action", action="signPayload"           â”‚ â•‘
â•‘  â”‚         signingRequest {protected, alg, kid, nonce, â€¦}     â”‚ â•‘
â•‘  â”‚     â€“ B: submit signature {protected, signature}           â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                  â•‘ compile/build
                                  â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    DID Document Compiler                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â€¢ build DID + Document                                     â”‚ â•‘
â•‘  â”‚ â€¢ 1Ã— verificationMethod (policy)                           â”‚ â•‘
â•‘  â”‚ â€¢ relations standard only                                  â”‚ â•‘
â•‘  â”‚ â€¢ JWK only + ordre stable                                  â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                  â•‘ signer avant publish (BYOS)
                                  â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     Proof & Crypto Engine                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â€¢ parse certs â†’ JWK                                        â”‚ â•‘
â•‘  â”‚ â€¢ prÃ©parer lâ€™input JWSâ€‘2020 (detached, b64=false, kid)     â”‚ â•‘
â•‘  â”‚ â€¢ vÃ©rifier la signature (signingResponse)                  â”‚ â•‘
â•‘  â”‚ â€¢ attacher la preuve JsonWebSignature2020 (obligatoire)    â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                  â•‘ write atomique
                                  â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   Central DID Hosting (Nginx)                    â•‘
â•‘                   https://host/.../did.json                      â•‘
â•‘                  â† Source de vÃ©ritÃ© opÃ©rat.                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          (option) DID Resolver API â†’ lit le did.json publiÃ©
"""

"""
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Central DID Hosting (Nginx)      â”‚
                    â”‚   https://host/.../did.json        â”‚
                    â”‚   â† Source de vÃ©ritÃ© opÃ©rat.       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ (7) write atomique
                                   â”‚
                                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                          â”‚
        â”‚              DID Registry API                            â”‚ (3) compile/build
        â”‚          (Django â€“ logique mÃ©tier)                       â”‚     â€¢ build DID + Document
        â”‚                                                          â”‚     â€¢ 1Ã— verificationMethod
        â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ JWK only + ordre stable
           â”‚          â”‚                      â”‚
           â”‚          â”‚                      â”‚ (6) submit signature
           â”‚          â”‚                      â”‚     â€¢ signingResponse {protected, signature}
           â”‚          â”‚                      â”‚     â€¢ vÃ©rifier signature
           â”‚          â”‚                      â”‚     â€¢ attacher preuve JsonWebSignature2020
           â”‚          â”‚                      â”‚
           â”‚          â”‚                      â”‚ (4) request signature
           â”‚          â”‚                      â”‚     â€¢ didState.state == "action"
   create()â”‚    (2)   â”‚                      â”‚     â€¢ didState.action == "signPayload"
     DID   â”‚ preview/ â”‚                      â”‚     â€¢ signingRequest {protected, alg, kid, nonce}
   (DRAFT) â”‚ compile  â”‚                      â”‚
           â”‚ (no I/O) â”‚                      â”‚
           â–¼          â”‚                      â–¼
          ğŸ‘¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    (1) generate DID                     â”‚  Owner  â”‚ (5) review payload, then sign
        controller keys                  â”‚  (BYOS) â”‚     â€¢ parse certs â†’ JWK
        â€¢ validation/gouvernance         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ prÃ©parer input JWS-2020
        â€¢ publish preprod/prod                           â€¢ signature detached (b64=false)
"""
